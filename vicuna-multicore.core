CAPI=2:
name: "fzi:vicuna:multicore:0.0.1"
description: "a multicore system with one management core and multiple ai accellerator cores"
filesets:
  rtl:
    depend:
      - "lowrisc:ip:rv_core_ibex:0.1"
      - "lowrisc:ip:xbar_main:0.1"
      - "lowrisc:ip:xbar_management_peripherals:0.1"
      - "lowrisc:ip:dma:0.1"
      - "lowrisc:ip:rv_timer:0.1"
      - "fzi:ip:simple_uart"
      - "fzi:ip:sram:0.1"
      - "fzi:ip:vicuna_tlul:0.1"
    files:
      - "src/system.sv"
    file_type: "systemVerilogSource"

  verilator:
    depend:
#      - "lowrisc:ibex:sim_shared"
      - "lowrisc:dv_verilator:memutil_verilator"
      - "lowrisc:dv_verilator:simutil_verilator"
      - "lowrisc:dv_verilator:ibex_pcounts"
      - "lowrisc:dv_dpi_c:uartdpi:0.1"
      - "lowrisc:dv_dpi_sv:uartdpi:0.1"
    files:
      - "simulation/top_verilator.sv": { file_type: systemVerilogSource }
      - "simulation/verilator.cc" : { file_type: cppSource }
      - "simulation/verilator.h":  { file_type: cppSource, is_include_file: true}
    #  - "dv/verilator/vicuna_demo_system_main.cc" : { file_type: cppSource }
    #  - dv/verilator/demo_system_verilator_lint.vlt:  { file_type: vlt }
  
  fpga_common:
    depend:
      - "lowrisc_xif:ibex:fpga_xilinx_shared"
    files:
      - "fpga/clocks.xdc": { file_type: xdc }
      - "configure_vivado_project.tcl": { file_type: tcl }

  zcu102:
    depend:
      - "fzi:xilinx:zcu102_ddr4"
    files:
      - "fpga/zcu102/top_zcu102.sv": { file_type: systemVerilogSource }
      - "fpga/zcu102/pins_zcu102.xdc": { file_type: xdc }

  vcu128:
    depend:
      - "fzi:xilinx:vcu128_ddr4"
    files:
      - "fpga/vcu128/top_vcu128.sv": { file_type: systemVerilogSource }
      - "fpga/vcu128/pins_vcu128.xdc": { file_type: xdc }


parameters:
  PRIM_DEFAULT_IMPL:
    datatype: "str"
    description: "Primitives implementation to use, e.g. prim_pkg::ImplGeneric."
    paramtype: "vlogdefine"
  ManagementDataFile:
    datatype: "str"
    description: "the initial data memory for the scratchpad memory of the management core"
    paramtype: "vlogparam"
  ManagementInstrFile:
    datatype: "str"
    description: "the initial data memory for the scratchpad memory of the management core"
    paramtype: "vlogparam"
  VectorInstrFile:
    datatype: "str"
    description: "the initial data memory for the scratchpad memory of the management core"
    paramtype: "vlogparam"
  VectorDataFile:
    datatype: "str"
    description: "the initial data memory for the scratchpad memory of the management core"
    paramtype: "vlogparam"
  TARGET_ZCU102:
    datatype: "bool"
    description: "Target the ZCU102 board."
    paramtype: "vlogdefine"
  TARGET_VCU128:
    datatype: "bool"
    description: "Target the VCU128 board."
    paramtype: "vlogdefine"
  

targets:
  default: &default
    filesets:
      - rtl
    parameters:

  sim:
    <<: *default
    description: "Run the device in a simulation"
    filesets_append:
    - verilator
    default_tool: "verilator"
    toplevel: "top_verilator"
    tools:
      verilator:
        mode: "cc"
        verilator_options:
          # --- tracing ---
          - '--trace'
          - '--trace-fst' # requires -DVM_TRACE_FMT_FST in CFLAGS
          - '--trace-structs'
          - '--trace-params'
          - '--trace-max-array 1024'

          - '-CFLAGS "-std=c++14 -Wall -DVM_TRACE_FMT_FST -DTOPLEVEL_NAME=top_verilator"'
          - '-LDFLAGS "-pthread -lutil -lelf"'
          - '-Wno-PINMISSING'
          - '-Wno-WIDTHEXPAND'
          - '-Wno-UNSIGNED'
          # aperrantly, the vicuna-demo-system works with a different version of
          # verilog, as this one does not allow Width truncation and multidriven
          # signals by default. However, the opentitan code makes use of these
          # 'features', meaning those errors need to be disabled
          - '-Wno-WIDTHTRUNC'
          - '-Wno-MULTIDRIVEN'
          # some signal in ibex is unoptimizable
          - '-Wno-UNOPTFLAT'
    parameters: 
      - PRIM_DEFAULT_IMPL=prim_pkg::ImplGeneric
    flags:
      use_bscane_tap: false

  synth_zcu102:
    <<: *default
    description: "Synthesize the design for the ZCU102 board"
    filesets_append:
      - fpga_common
      - zcu102
    default_tool: vivado
    toplevel: top_zcu102
    tools:
      vivado:
        part: "xczu9eg-ffvb1156-2-e"
        board_part: "xilinx.com:zcu102:part0:3.4"
        jobs: 64
    parameters:
      - PRIM_DEFAULT_IMPL=prim_pkg::ImplXilinx_ultrascale
      - TARGET_ZCU102=true

  synth_vcu128:
    <<: *default
    description: "Synthesize the design for the VCU128 board"
    filesets_append:
      - fpga_common
      - vcu128
    default_tool: vivado
    toplevel: top_vcu128
    tools:
      vivado:
        part: "xcvu37p-fsvh2892-2L-e"
        board_part: "xilinx.com:vcu128:part0:1.0"
        jobs: 64
    parameters:
      - PRIM_DEFAULT_IMPL=prim_pkg::ImplXilinx_ultrascale
      - TARGET_VCU128=true
